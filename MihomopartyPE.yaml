# æ”¹è‡ªæ·±å··æœ‰å–µ2.1.6
# é€‚ç”¨ç‰ˆæœ¬ï¼šæ‰€æœ‰ä½¿ç”¨ Mihomo å†…æ ¸çš„ç¨‹åº

  # æ··åˆç«¯å£ HTTPå’ŒSOCKS5ç”¨ä¸€ä¸ªç«¯å£
  # mixed-port: 7897
port: 7890
socks-port: 7891
mixed-port: 7892
redir-port: 7893
tproxy-port: 7894
# TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP
tcp-concurrent: true
# å…è®¸å±€åŸŸç½‘çš„è¿æ¥ï¼ˆå¯ç”¨æ¥å…±äº«ä»£ç†ï¼‰
allow-lan: true
# å¼€å¯ IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 é“¾æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•
ipv6: true
# è§„åˆ™æ¨¡å¼ï¼šrule/global/direct/script
mode: rule
# è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«: silent/error/warning/info/debug
log-level: info
# å…¨å±€ TLS æŒ‡çº¹
global-client-fingerprint: chrome
# åŒ¹é…æ‰€æœ‰è¿›ç¨‹ï¼ˆalways/strict/offï¼‰
find-process-mode: strict
#å¤–éƒ¨æ§åˆ¶å™¨
external-controller: 0.0.0.0:9090
  # 127.0.0.1:9090
  # external-ui: ui
  # external-ui-url: 'https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip'
# ç»Ÿä¸€å»¶è¿Ÿ
unified-delay: true
# geoipæ•°æ®åº“ä½¿ç”¨db
geodata-mode: false
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
 # geodata-mode: true
geox-url:
  # geoip: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"
  # geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://geodata.kelee.one/Country-Masaiki.mmdb"
  asn: "https://geodata.kelee.one/GeoLite2-ASN-P3TERX.mmdb"
                         
profile:
  # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-selected: true 
  # æŒä¹…åŒ– fake-ip
  store-fake-ip: true  

##### å—…æ¢åŸŸå å¯é€‰é…ç½® ####
sniffer:               
  enable: true
  # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  # è§£æçº¯æ´ip
  parse-pure-ip: true 
  # å¼ºåˆ¶æ˜ å°„dns
  force-dns-mapping: true
  # è¦†ç›–ç›®æ ‡
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  force-domain:
    - +.v2ex.com
  skip-domain:
    - Mijia Cloud

#### Tun é…ç½® ####
tun:
  enable: true
  # å¯é€‰ï¼š system/gvisor/mixedï¼›
  stack: system
  # dnsåŠ«æŒ,ä¸€èˆ¬è®¾ç½®ä¸º any:53 å³å¯, å³åŠ«æŒæ‰€æœ‰53ç«¯å£çš„udpæµé‡
  dns-hijack: [any:53]
  # è‡ªåŠ¨è®¾ç½®å…¨å±€è·¯ç”±ï¼Œå¯ä»¥è‡ªåŠ¨å°†å…¨å±€æµé‡è·¯ç”±è¿›å…¥tunç½‘å¡ã€‚
  auto-route: true
  # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡
  auto-detect-interface: true

#### DNS é…ç½® ####
dns:
  enable: true
  # IPV6è§£æå¼€å…³ï¼›å¦‚æœä¸ºfalseï¼Œå°†è¿”å›ipv6ç»“æœä¸ºç©º
  ipv6: true
  # æ¨¡å¼ï¼šredir-hostæˆ–fake-ip
  enhanced-mode: fake-ip
  # DNSç›‘å¬åœ°å€
  listen: 0.0.0.0:1053
  # Fake-IPè§£æåœ°å€æ± 
  fake-ip-range: 28.0.0.1/8
    # fake-ip-range: 198.18.0.1/16
  # fakeip è¿‡æ»¤ï¼Œä»¥ä¸‹åœ°å€ä¸ä¼šä¸‹å‘ fakeip æ˜ å°„ç”¨äºè¿æ¥
  fake-ip-filter: ['*.lan','*.direct', cable.auth.com, '*.msftconnecttest.com', '*.msftncsi.com', network-test.debian.org, detectportal.firefox.com, resolver1.opendns.com, '*.srv.nintendo.net', '*.stun.playstation.net', xbox.*.microsoft.com, '*.xboxlive.com', stun.*, global.turn.twilio.com, global.stun.twilio.com, app.yinxiang.com, injections.adguard.org, local.adguard.org, cable.auth.com, localhost.*.qq.com, localhost.*.weixin.qq.com, '*.logon.battlenet.com.cn', '*.logon.battle.net', '*.blzstatic.cn', music.163.com, '*.music.163.com', '*.126.net', musicapi.taihe.com, music.taihe.com, songsearch.kugou.com, trackercdn.kugou.com, '*.kuwo.cn', api-jooxtt.sanook.com, api.joox.com, joox.com, y.qq.com, '*.y.qq.com', streamoc.music.tc.qq.com, mobileoc.music.tc.qq.com, isure.stream.qqmusic.qq.com, dl.stream.qqmusic.qq.com, aqqmusic.tc.qq.com, amobile.music.tc.qq.com, '*.xiami.com', '*.music.migu.cn', music.migu.cn, proxy.golang.org, '*.mcdn.bilivideo.cn', '*.cmpassport.com', id6.me, open.e.189.cn, mdn.open.wo.cn, opencloud.wostore.cn, auth.wosms.cn, '*.jegotrip.com.cn', '*.icitymobile.mobi', '*.pingan.com.cn', '*.cmbchina.com', '*.10099.com.cn', pool.ntp.org, '*.pool.ntp.org', ntp.*.com, time.*.com, 'ntp?.*.com', 'time?.*.com', time.*.gov, time.*.edu.cn, '*.ntp.org.cn', PDC._msDCS.*.*, DC._msDCS.*.*, GC._msDCS.*.*]
  #é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨
  nameserver: [quic://223.5.5.5, quic://223.6.6.6, https://1.12.12.12/dns-query, https://120.53.53.53/dns-query, https://doh.pub/dns-query, https://dns.alidns.com/dns-query]                     
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  # nameserver:
   # - https://223.5.5.5/dns-query#h3=true
   # - https://223.6.6.6/dns-query#h3=true

#### ç­–ç•¥ç»„å¼•ç”¨ç›¸å…³å‚æ•° ####
# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…çš„å‚æ•° [æ¯24å°æ—¶æ›´æ–°ä¸€æ¬¡è®¢é˜…èŠ‚ç‚¹ï¼Œæ¯ 60 ç§’ä¸€æ¬¡å¥åº·æ£€æŸ¥]
NodeParam: &NodeParam {type: http, interval: 86400, health-check: {enable: true, url: 'http://www.google.com/generate_204', interval: 60}}
# é”šç‚¹ - èŠ‚ç‚¹è®¢é˜…
proxy-providers: 
  Sub-Store:
  ########################################## è®¢é˜…é›†åˆåå­— urlé‡Œé¢å¯ä»¥æ”¾subã€æœºåœºè®¢é˜…ã€vpsã€base64ç­‰ #################################
    url: 'http://127.0.0.1:38324/download/collection/mihomo%2B'
    <<: *NodeParam
    path: './proxy_provider/Providers.yaml'

# é”šç‚¹ - èŠ‚ç‚¹ç­›é€‰ç»„
FilterHK: &FilterHK '^(?=.*((?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|Hong)\b))).*$'
FilterJP: &FilterJP '^(?=.*((?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|(\b(JP|Japan)\b))).*$'
FilterKR: &FilterKR '^(?=.*((?i)ğŸ‡°ğŸ‡·|éŸ©å›½|éŸ“|é¦–å°”|(\b(KR|Korea)\b))).*$'
FilterSG: &FilterSG '^(?=.*((?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|Singapore)\b))).*$'
FilterUS: &FilterUS '^(?=.*((?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|(\b(US|United States)\b))).*$'
FilterUK: &FilterUK '^(?=.*((?i)ğŸ‡¬ğŸ‡§|è‹±å›½|ä¼¦æ•¦|(\b(UK|United Kingdom)\b))).*$'
FilterFR: &FilterFR '^(?=.*((?i)ğŸ‡«ğŸ‡·|æ³•å›½|(\b(FR|France)\b))).*$'
FilterDE: &FilterDE '^(?=.*((?i)ğŸ‡©ğŸ‡ª|å¾·å›½|(\b(DE|Germany)\b))).*$'
FilterGame: &FilterGame '^(?=.*((?i)æ¸¸æˆ|ğŸ®|(\b(GAME)\b)))(?!.*((?i)å›å›½|æ ¡å›­)).*$'
FilterAll: &FilterAll '^(?=.*(.))(?!.*((?i)ç¾¤|é‚€è¯·|è¿”åˆ©|å¾ªç¯|å®˜ç½‘|å®¢æœ|ç½‘ç«™|ç½‘å€|è·å–|è®¢é˜…|æµé‡|åˆ°æœŸ|æœºåœº|ä¸‹æ¬¡|ç‰ˆæœ¬|å®˜å€|å¤‡ç”¨|è¿‡æœŸ|å·²ç”¨|è”ç³»|é‚®ç®±|å·¥å•|è´©å–|é€šçŸ¥|å€’å–|é˜²æ­¢|å›½å†…|åœ°å€|é¢‘é“|æ— æ³•|è¯´æ˜|ä½¿ç”¨|æç¤º|ç‰¹åˆ«|è®¿é—®|æ”¯æŒ|æ•™ç¨‹|å…³æ³¨|æ›´æ–°|ä½œè€…|åŠ å…¥|(\b(USE|USED|TOTAL|EXPIRE|EMAIL|Panel|Channel|Author)\b|(\d{4}-\d{2}-\d{2}|\d+G)))).*$'
# é”šç‚¹ - æ•…éšœè½¬ç§»å‚æ•° [æ¯ 10 ç§’ä¸€æ¬¡æƒ°æ€§å¥åº·æ£€æŸ¥ï¼Œæ—¶å»¶è¶…è¿‡ 2 ç§’åˆ¤å®šä¸ºå¤±è´¥ï¼Œå¤±è´¥ 3 æ¬¡åˆ™è‡ªåŠ¨è§¦å‘å¥åº·æ£€æŸ¥]
FallBack: &FallBack {type: fallback, interval: 10, lazy: true, url: 'http://www.google.com/generate_204', disable-udp: false, timeout: 2000, max-failed-times: 3, hidden: true, include-all-providers: true}
# é”šç‚¹ - è§„åˆ™å‚æ•° [æ¯å¤©æ›´æ–°ä¸€æ¬¡è®¢é˜…è§„åˆ™ï¼Œæ›´æ–°è§„åˆ™æ—¶ä½¿ç”¨ç›´è¿ç­–ç•¥]
RuleSet: &RuleSet {type: http, behavior: classical, interval: 86400, format: yaml, proxy: DIRECT}
# ç­–ç•¥ç»„
proxy-groups: 
  - {name: Proxy, type: select, proxies: [ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹], icon: 'https://raw.githubusercontent.com/pompurin404/mihomo-party/master/resources/icon.png'}
  #- {name: OpenAI, type: select, include-all: true, filter: *FilterAll, icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ChatGPT.png'}
  - {name: Telegram, type: select, proxies: [Proxy, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹], icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png'}
  - {name: Pixiv, type: select, proxies: [Proxy, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹], icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png'}
  - {name: Gamer, type: select, include-all: true, filter: *FilterGame, proxies: [DIRECT, Proxy], icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Game.png'}
  - {name: Microsoft, type: select, proxies: [DIRECT, Proxy, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹], icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png'}
  - {name: GlobalMedia, type: select, proxies: [Proxy, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹], icon: 'https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ForeignMedia.png'}

  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, <<: *FallBack, filter: *FilterHK}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, <<: *FallBack, filter: *FilterJP}
  - {name: ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹, <<: *FallBack, filter: *FilterKR}
  - {name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹, <<: *FallBack, filter: *FilterSG}
  - {name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹, <<: *FallBack, filter: *FilterUS}
  - {name: ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹, <<: *FallBack, filter: *FilterUK}
  - {name: ğŸ‡«ğŸ‡· æ³•å›½èŠ‚ç‚¹, <<: *FallBack, filter: *FilterFR}
  - {name: ğŸ‡©ğŸ‡ª å¾·å›½èŠ‚ç‚¹, <<: *FallBack, filter: *FilterDE}
# è®¢é˜…è§„åˆ™
rule-providers:
  GlobalMedia:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml'
    path: './RuleSet/GlobalMedia.yaml'

  ChinaMedia:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMedia/ChinaMedia.yaml'
    path: './RuleSet/ChinaMedia.yaml'

  Pixiv:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/GGsimita/clash-mihomo-js/refs/heads/main/Script-pub/Pixivpub.list'
    path: './rule-providers/Pixiv.list'

  Telegram:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/GGsimita/clash-mihomo-js/refs/heads/main/Script-pub/telegram.yaml'
    path: './rule-providers/Telegram.list'

  Microsoft:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/GGsimita/clash-mihomo-js/refs/heads/main/Script-pub/edgepub.yaml'
    # url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft_No_Resolve.yaml'
    path: './RuleSet/Microsoft.yaml'

  Game:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/GGsimita/clash-mihomo-js/refs/heads/main/Script-pub/gamepub.yaml'
    # url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Epic/Epic.yaml'
    path: './rulesets/loyalsoldier/gamedl.list'

  Proxy:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Proxy/Proxy_Classical_No_Resolve.yaml'
    path: './RuleSet/Proxy.yaml'

  China:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/ChinaMax/ChinaMax_Classical.yaml'
    path: './RuleSet/China.yaml'

  LAN:
    <<: *RuleSet
    url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml'
    path: './RuleSet/LAN.yaml'
# åˆ†æµè§„åˆ™æŒ‡å‘
rules:
 - RULE-SET,ChinaMedia,DIRECT
 - RULE-SET,GlobalMedia,GlobalMedia
 - RULE-SET,Microsoft,Microsoft
 - RULE-SET,Telegram,Telegram
 - RULE-SET,Game,Gamer
 - RULE-SET,Pixiv,Pixiv
 - RULE-SET,Proxy,Proxy
 - RULE-SET,China,DIRECT
 - RULE-SET,LAN,DIRECT
 - GEOIP,CN,DIRECT
 - MATCH,Proxy

script:
  shortcuts:
    quic: network == 'udp' and dst_port == 443
